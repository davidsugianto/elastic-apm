/*! For license information please see elastic-apm-rum.umd.min.js.LICENSE */
!function(n){var r={};function i(t){if(r[t])return r[t].exports;var e=r[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}i.m=n,i.c=r,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=5)}([function(t,e,n){t.exports=function(){"use strict";function c(t){return"function"==typeof t}var n=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},r=0,e=void 0,i=void 0,s=function(t,e){v[r]=t,v[r+1]=e,2===(r+=2)&&(i?i(h):y())},t="undefined"!=typeof window?window:void 0,o=t||{},a=o.MutationObserver||o.WebKitMutationObserver,u="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),f="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function d(){var t=setTimeout;return function(){return t(h,1)}}var v=new Array(1e3);function h(){for(var t=0;t<r;t+=2){var e=v[t],n=v[t+1];e(n),v[t]=void 0,v[t+1]=void 0}r=0}var l,p,g,m,y=void 0;function _(t,e){var n=this,r=new this.constructor(w);void 0===r[b]&&M(r);var i=n._state;if(i){var o=arguments[i-1];s(function(){return F(i,r,o,n._result)})}else A(n,r,t,e);return r}function S(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(w);return k(e,t),e}y=u?function(){return process.nextTick(h)}:a?(p=0,g=new a(h),m=document.createTextNode(""),g.observe(m,{characterData:!0}),function(){m.data=p=++p%2}):f?((l=new MessageChannel).port1.onmessage=h,function(){return l.port2.postMessage(0)}):void 0===t?function(){try{var t=Function("return this")().require("vertx");return void 0===(e=t.runOnLoop||t.runOnContext)?d():function(){e(h)}}catch(t){return d()}}():d();var b=Math.random().toString(36).substring(2);function w(){}var T=void 0,E=1,x=2;function C(t,e,n,r){try{t.call(e,n,r)}catch(t){return t}}function L(t,e,n){var r,i,o,a;e.constructor===t.constructor&&n===_&&e.constructor.resolve===S?(o=t,(a=e)._state===E?I(o,a._result):a._state===x?N(o,a._result):A(a,void 0,function(t){return k(o,t)},function(t){return N(o,t)})):void 0===n?I(t,e):c(n)?(r=e,i=n,s(function(e){var n=!1,t=C(i,r,function(t){n||(n=!0,r!==t?k(e,t):I(e,t))},function(t){n||(n=!0,N(e,t))},e._label);!n&&t&&(n=!0,N(e,t))},t)):I(t,e)}function k(e,t){if(e===t)N(e,new TypeError("You cannot resolve a promise with itself"));else if(i=typeof(r=t),null===r||"object"!==i&&"function"!==i)I(e,t);else{var n=void 0;try{n=t.then}catch(t){return void N(e,t)}L(e,t,n)}var r,i}function O(t){t._onerror&&t._onerror(t._result),j(t)}function I(t,e){t._state===T&&(t._result=e,t._state=E,0!==t._subscribers.length&&s(j,t))}function N(t,e){t._state===T&&(t._state=x,t._result=e,s(O,t))}function A(t,e,n,r){var i=t._subscribers,o=i.length;t._onerror=null,i[o]=e,i[o+E]=n,i[o+x]=r,0===o&&t._state&&s(j,t)}function j(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,i=void 0,o=t._result,a=0;a<e.length;a+=3)r=e[a],i=e[a+n],r?F(n,r,i,o):i(o);t._subscribers.length=0}}function F(t,e,n,r){var i=c(n),o=void 0,a=void 0,s=!0;if(i){try{o=n(r)}catch(t){s=!1,a=t}if(e===o)return void N(e,new TypeError("A promises callback cannot return that same promise."))}else o=r;e._state!==T||(i&&s?k(e,o):!1===s?N(e,a):t===E?I(e,o):t===x&&N(e,o))}var R=0;function M(t){t[b]=R++,t._state=void 0,t._result=void 0,t._subscribers=[]}var P=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(w),this.promise[b]||M(this.promise),n(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?I(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&I(this.promise,this._result))):N(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===T&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===S){var i=void 0,o=void 0,a=!1;try{i=e.then}catch(t){a=!0,o=t}if(i===_&&e._state!==T)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(n===q){var s=new n(w);a?N(s,o):L(s,e,i),this._willSettleAt(s,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},t.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===T&&(this._remaining--,t===x?N(r,n):this._result[e]=n),0===this._remaining&&I(r,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;A(t,void 0,function(t){return n._settledAt(E,e,t)},function(t){return n._settledAt(x,e,t)})},t}(),q=function(){function e(t){this[b]=R++,this._result=this._state=void 0,this._subscribers=[],w!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){try{t(function(t){k(e,t)},function(t){N(e,t)})}catch(t){N(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var n=this.constructor;return c(e)?this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})}):this.then(e,e)},e}();return q.prototype.then=_,q.all=function(t){return new P(this,t).promise},q.race=function(i){var o=this;return n(i)?new o(function(t,e){for(var n=i.length,r=0;r<n;r++)o.resolve(i[r]).then(t,e)}):new o(function(t,e){return e(new TypeError("You must pass an array to race."))})},q.resolve=S,q.reject=function(t){var e=new this(w);return N(e,t),e},q._setScheduler=function(t){i=t},q._setAsap=function(t){s=t},q._asap=s,q.polyfill=function(){var t=void 0;if("undefined"!=typeof global)t=global;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=q},q.Promise=q}()},function(t,e){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);t.exports=function(){return n(r),r}}else{var i=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),i[e]=t>>>((3&e)<<3)&255;return i}}},function(n,r,i){var o,a,s;!function(t,e){"use strict";a=[i(4)],void 0===(s="function"==typeof(o=function(s){var n=/(^|@)\S+\:\d+/,r=/^\s*at .*(\S+\:\d+|\(native\))/m,i=/^(eval@)?(\[native code\])?$/;function o(t,e,n){if("function"==typeof Array.prototype.map)return t.map(e,n);for(var r=new Array(t.length),i=0;i<t.length;i++)r[i]=e.call(n,t[i]);return r}function a(t,e,n){if("function"==typeof Array.prototype.filter)return t.filter(e,n);for(var r=[],i=0;i<t.length;i++)e.call(n,t[i])&&r.push(t[i]);return r}return{parse:function(t){if(void 0!==t.stacktrace||void 0!==t["opera#sourceloc"])return this.parseOpera(t);if(t.stack&&t.stack.match(r))return this.parseV8OrIE(t);if(t.stack)return this.parseFFOrSafari(t);throw new Error("Cannot parse given Error object")},extractLocation:function(t){if(-1===t.indexOf(":"))return[t];var e=/(.+?)(?:\:(\d+))?(?:\:(\d+))?$/.exec(t.replace(/[\(\)]/g,""));return[e[1],e[2]||void 0,e[3]||void 0]},parseV8OrIE:function(t){var e=a(t.stack.split("\n"),function(t){return!!t.match(r)},this);return o(e,function(t){-1<t.indexOf("(eval ")&&(t=t.replace(/eval code/g,"eval").replace(/(\(eval at [^\()]*)|(\)\,.*$)/g,""));var e=t.replace(/^\s+/,"").replace(/\(eval code/g,"(").split(/\s+/).slice(1),n=this.extractLocation(e.pop()),r=e.join(" ")||void 0,i=-1<function(t,e){{if("function"==typeof Array.prototype.indexOf)return t.indexOf(e);for(var n=0;n<t.length;n++)if(t[n]===e)return n;return-1}}(["eval","<anonymous>"],n[0])?void 0:n[0];return new s(r,void 0,i,n[1],n[2],t)},this)},parseFFOrSafari:function(t){var e=a(t.stack.split("\n"),function(t){return!t.match(i)},this);return o(e,function(t){if(-1<t.indexOf(" > eval")&&(t=t.replace(/ line (\d+)(?: > eval line \d+)* > eval\:\d+\:\d+/g,":$1")),-1===t.indexOf("@")&&-1===t.indexOf(":"))return new s(t);var e=t.split("@"),n=this.extractLocation(e.pop()),r=e.join("@")||void 0;return new s(r,void 0,n[0],n[1],n[2],t)},this)},parseOpera:function(t){return!t.stacktrace||-1<t.message.indexOf("\n")&&t.message.split("\n").length>t.stacktrace.split("\n").length?this.parseOpera9(t):t.stack?this.parseOpera11(t):this.parseOpera10(t)},parseOpera9:function(t){for(var e=/Line (\d+).*script (?:in )?(\S+)/i,n=t.message.split("\n"),r=[],i=2,o=n.length;i<o;i+=2){var a=e.exec(n[i]);a&&r.push(new s(void 0,void 0,a[2],a[1],void 0,n[i]))}return r},parseOpera10:function(t){for(var e=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,n=t.stacktrace.split("\n"),r=[],i=0,o=n.length;i<o;i+=2){var a=e.exec(n[i]);a&&r.push(new s(a[3]||void 0,void 0,a[2],a[1],void 0,n[i]))}return r},parseOpera11:function(t){var e=a(t.stack.split("\n"),function(t){return!!t.match(n)&&!t.match(/^Error created at/)},this);return o(e,function(t){var e,n=t.split("@"),r=this.extractLocation(n.pop()),i=n.shift()||"",o=i.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;i.match(/\(([^\)]*)\)/)&&(e=i.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var a=void 0===e||"[arguments not available]"===e?void 0:e.split(",");return new s(o,a,r[0],r[1],r[2],t)},this)}}})?o.apply(r,a):o)||(n.exports=s)}()},,function(n,r,t){var i,o,a;!function(t,e){"use strict";o=[],void 0===(a="function"==typeof(i=function(){function e(t){return!isNaN(parseFloat(t))&&isFinite(t)}function t(t,e,n,r,i,o){void 0!==t&&this.setFunctionName(t),void 0!==e&&this.setArgs(e),void 0!==n&&this.setFileName(n),void 0!==r&&this.setLineNumber(r),void 0!==i&&this.setColumnNumber(i),void 0!==o&&this.setSource(o)}return t.prototype={getFunctionName:function(){return this.functionName},setFunctionName:function(t){this.functionName=String(t)},getArgs:function(){return this.args},setArgs:function(t){if("[object Array]"!==Object.prototype.toString.call(t))throw new TypeError("Args must be an Array");this.args=t},getFileName:function(){return this.fileName},setFileName:function(t){this.fileName=String(t)},getLineNumber:function(){return this.lineNumber},setLineNumber:function(t){if(!e(t))throw new TypeError("Line Number must be a Number");this.lineNumber=Number(t)},getColumnNumber:function(){return this.columnNumber},setColumnNumber:function(t){if(!e(t))throw new TypeError("Column Number must be a Number");this.columnNumber=Number(t)},getSource:function(){return this.source},setSource:function(t){this.source=String(t)},toString:function(){return(this.getFunctionName()||"{anonymous}")+"("+(this.getArgs()||[]).join(",")+")"+(this.getFileName()?"@"+this.getFileName():"")+(e(this.getLineNumber())?":"+this.getLineNumber():"")+(e(this.getColumnNumber())?":"+this.getColumnNumber():"")}},t})?i.apply(r,o):i)||(n.exports=a)}()},function(t,e,n){"use strict";n.r(e);var r=n(1),o=n.n(r),f=n(0),i=[].slice;for(var a=[],s=0;s<256;++s)a[s]=(s+256).toString(16).substr(1);function c(t){if(t&&t.traceId&&t.id&&t.parentId){var e=t.sampled?"01":"00",n=t.sampled?t.id:t.parentId;return"00-"+t.traceId+"-"+n+"-"+e}}function h(e,t){var n=!1;return"string"==typeof t?n=e===t:Array.isArray(t)&&t.forEach(function(t){n||(n=h(e,t))}),n}function p(t){var e,n,r,i;return(e=o()(),r=n||0,[(i=a)[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")).substr(0,t)}function u(){return"undefined"!=typeof window&&"function"==typeof Array.prototype.forEach&&"function"==typeof JSON.stringify&&"function"==typeof Function.bind&&window.performance&&"function"==typeof window.performance.now&&"withCredentials"in new window.XMLHttpRequest}function d(t,e,n){if(n&&t){var r=E(t);return e&&(e=String(e)),n[r]=e,n}}var v=["fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"];function g(){return{page:{referer:document.referrer,url:window.location.href}}}function l(t){return t&&t.split("?")[0]}function m(t){return null!==t&&"object"==typeof t}function y(t,e,n){for(var r=0,i=e.length;r<i;++r){var o=e[r];if(m(o)||"function"==typeof o)for(var a=Object.keys(o),s=0,c=a.length;s<c;s++){var u=a[s],f=o[u];n&&m(f)?(m(t[u])||(t[u]=Array.isArray(f)?[]:{}),y(t[u],[f],!1)):t[u]=f}}return t}function _(){if("undefined"!=typeof document){var t=document.currentScript;return t||function(){if("undefined"!=typeof document)for(var t=document.getElementsByTagName("script"),e=0,n=t.length;e<n;e++){var r=t[e];if(0<r.src.indexOf("elastic"))return r}}()}}function S(t){return y(t,i.call(arguments,1),!1)}function b(t){return y(t,i.call(arguments,1),!0)}function w(t){return void 0===t}function T(){}function E(t){return t.replace(/[.*"]/g,"_")}function x(){var n,r,i,t=(n=window.performance.timing,r=n.fetchStart,i={},v.forEach(function(t){var e=n[t];e&&r<=e&&(i[t]=e-r)}),i),e=function(){var t={},e=window.performance;if("function"==typeof e.getEntriesByType){var n=e.getEntriesByType("paint");if(0<n.length)for(var r=e.timing,i=r.fetchStart-r.navigationStart,o=0;o<n.length;o++){var a=n[o],s=0<=i?a.startTime-i:a.startTime;t[a.name]=s}}return t}(),o={timeToFirstByte:t.responseStart,domInteractive:t.domInteractive,domComplete:t.domComplete};return e["first-contentful-paint"]&&(o.firstContentfulPaint=e["first-contentful-paint"]),{navigationTiming:t,agent:o}}function C(){return window.performance.now()}function L(t){return"number"==typeof t&&0<=t?t:C()}function k(t,e){return w(e)||w(t)?null:parseFloat(e-t)}var O={fetchInProgress:!1};function I(t){return"__apm_symbol__"+t}function N(t,e,n){for(var r=t;r&&!r.hasOwnProperty(e);)r=Object.getPrototypeOf(r);!r&&t[e]&&(r=t);var i,o,a,s,c=I(e);if(r&&!(i=r[c])){i=r[c]=r[e];var u=r&&Object.getOwnPropertyDescriptor(r,e);if(!(s=u)||!1!==s.writable&&("function"!=typeof s.get||void 0!==s.set)){var f=n(i,c,e);r[e]=function(){return f(this,arguments)},o=r[e],a=i,o[I("OriginalDelegate")]=a}}return i}var A=I("xhrIgnore"),j=I("xhrSync"),F=I("xhrURL"),R=I("xhrMethod"),M="schedule",P="invoke",q="clear",H="addEventListener",B="removeEventListener",D=["link","css","script","img","xmlhttprequest","fetch","beacon","iframe"],Q=3e5,U="page-load",z="Unknown",$=60,V=1024,X="transaction:end",J="config:change",Y="xmlhttprequest",Z="fetch",G="history",K="elastic_apm_config",W=I("xhrTask"),tt=I("xhrListener"),et=I("xhrScheduled");function nt(s){var t=XMLHttpRequest.prototype,c=t[H],u=t[B];if(!c){var e=window.XMLHttpRequestEventTarget;if(e){var n=e.prototype;c=n[H],u=n[B]}}var f="readystatechange";function d(t){t.state=P,t.ignore||s(P,t)}function i(n){XMLHttpRequest[et]=!1,n.state=M,n.ignore||s(M,n);var r,i=n.data,o=i.target,t=o[tt];c||(c=o[H],u=o[B]),t&&(u.call(o,f,t),u.call(o,"load",t));var e=o[tt]=function(t){var e=t.type;r?r!=e&&setTimeout(function(){n.state!==P&&d(n)},0):o.readyState===o.DONE&&!i.aborted&&XMLHttpRequest[et]&&n.state===M&&(r=e)};c.call(o,f,e),c.call(o,"load",e),o[W]||(o[W]=n);var a=v.apply(o,i.args);return XMLHttpRequest[et]=!0,a}var r=N(t,"open",function(){return function(t,e){return t[R]=e[0],t[F]=e[1],t[j]=!1===e[2],r.apply(t,e)}}),v=N(t,"send",function(){return function(t,e){var n={source:Y,state:"",type:"macroTask",ignore:t[A],data:{target:t,method:t[R],sync:t[j],url:t[F],args:e,aborted:!1}},r=i(n);return t[j]&&d(n),r}}),o=N(t,"abort",function(){return function(t,e){var n,r=t[W];if(r&&"string"==typeof r.type){if(r.data&&r.data.aborted)return;(n=r).state=q,s(q,n),n.data.aborted=!0}return o.apply(t,e)}})}function rt(s){if(window.fetch&&window.Request){var c=window.fetch;window.fetch=function(t,e){var i,n,o=this,r=arguments;if("string"==typeof t)i=new Request(t,e),n=t;else{if(!t)return c.apply(o,r);n=(i=t).url}var a={source:Z,state:"",type:"macroTask",data:{target:i,method:i.method,sync:!1,url:n,args:r,aborted:!1}};return new f.Promise(function(e,n){var t,r;O.fetchInProgress=!0,(t=a).state=M,s(M,t);try{r=c.apply(o,[i])}catch(t){return n(t),a.data.error=t,u(a),void(O.fetchInProgress=!1)}r.then(function(t){e(t),f.Promise.resolve().then(function(){a.data.response=t,u(a)})},function(t){n(t),f.Promise.resolve().then(function(){a.data.error=t,u(a)})}),O.fetchInProgress=!1})}}function u(t){t.state=P,s(P,t)}}var it=function(){function t(){this.observers={}}var e=t.prototype;return e.observe=function(e,n){var r=this;if("function"==typeof n)return this.observers[e]||(this.observers[e]=[]),this.observers[e].push(n),function(){var t=r.observers[e].indexOf(n);-1<t&&r.observers[e].splice(t,1)}},e.sendOnly=function(t,e){var n=this.observers[t];n&&n.forEach(function(t){try{t.apply(void 0,e)}catch(t){console.log(t,t.stack)}})},e.send=function(t,e){this.sendOnly(t+":before",e),this.sendOnly(t,e),this.sendOnly(t+":after",e)},t}(),ot=new it,at=!1;function st(){return at||(at=!0,nt(function(t,e){ot.send(Y,[t,e])}),rt(function(t,e){ot.send(Z,[t,e])}),function(r){if(window.history){var i=history.pushState;"function"==typeof i&&(history.pushState=function(t,e,n){r(P,{source:G,data:{state:t,title:e,url:n}}),i.apply(this,arguments)})}}(function(t,e){ot.send(G,[t,e])})),ot}var ct=!1,ut=!1;var ft=n(2),dt=n.n(ft);function vt(t){var e=t.error,n=t.filename,r=t.lineno,i=t.colno,o=[];if(e)try{o=dt.a.parse(e)}catch(t){}return 0===o.length&&(o=[{fileName:n,lineNumber:r,columnNumber:i}]),o.map(function(t){return t.functionName&&(t.functionName=(e=t.functionName,e=1<(n=(e=(e=(e=1<(n=e.split("/")).length?["Object",n[n.length-1]].join("."):n[0]).replace(/.<$/gi,".<anonymous>")).replace(/^Anonymous function$/,"<anonymous>")).split(".")).length?n[n.length-1]:n[0])),t;var e,n}).map(function(t){var e=t.fileName,n=t.lineNumber,r=t.columnNumber,i=t.functionName,o=void 0===i?"<anonymous>":i;if(!e&&!n)return{};if(!r&&!n)return{};var a,s,c,u,f=(void 0===(a=e)&&(a=""),"<anonymous>"===a&&(a=""),a),d=(s=f,c=window.location.origin||window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),-1<s.indexOf(c)&&(s=s.replace(c+"/","")),s);return(u=f)&&0===window.location.href.indexOf(u)&&(d="(inline script)"),{abs_path:e,filename:d,function:o,lineno:n,colno:r}})}var ht={service:{name:[V,!0],version:!0,agent:{version:[V,!0]},environment:!0}},lt={"*":!0,headers:{"*":!0}},pt={user:{id:!0,email:!0,username:!0},tags:{"*":!0},http:{response:lt},response:lt},gt={name:[V,!0],type:[V,!0],id:[V,!0],trace_id:[V,!0],parent_id:[V,!0],transaction_id:[V,!0],subtype:!0,action:!0,context:pt},mt={name:!0,parent_id:!0,type:[V,!0],id:[V,!0],trace_id:[V,!0],span_count:{started:[V,!0]},context:pt},yt={id:[V,!0],trace_id:!0,transaction_id:!0,parent_id:!0,culprit:!0,exception:{type:!0},transaction:{type:!0},context:pt};function _t(t){return null==t||""===t||void 0===t}function St(t,e,n){var r,i,o,a,s=(r=t[e],i=n[0],o=n[1],void 0===i&&(i=V),void 0===o&&(o=!1),void 0===a&&(a="N/A"),o&&_t(r)&&(r=a),"string"==typeof r?r.substring(0,i):r);_t(s)?delete t[e]:t[e]=s}function bt(r,i,o){void 0===r&&(r={}),void 0===o&&(o=i);for(var a=Object.keys(r),s=[],t=function(t){var e=a[t],n=!0===r[e]?s:r[e];Array.isArray(n)?"*"===e?Object.keys(o).forEach(function(t){return St(o,t,n)}):St(o,e,n):bt(n,i,o[e])},e=0;e<a.length;e++)t(e);return i}var wt=function(){function t(t,e,n){this._apmServer=t,this._configService=e,this._transactionService=n}var e=t.prototype;return e.createErrorDataModel=function(t){var e=vt(t),n=e.filter(function(t){var e=t.filename,n=t.lineno;return void 0!==e&&void 0!==n}),r="(inline script)",i=n[n.length-1];i&&i.filename&&(r=i.filename);var o=t.message,a=t.error,s=o,c="",u={};a&&"object"==typeof a&&(s=s||a.message,c=a.name,u=this._getErrorProperties(a)),c||s&&-1<s.indexOf(":")&&(c=s.split(":")[0]);var f=this._transactionService.getCurrentTransaction(),d=f?f.context:{},v=this._configService.get("context"),h=b({},g(),d,v,u),l={id:p(),culprit:r,exception:{message:s,stacktrace:n,type:c},context:h};return f&&(l=S(l,{trace_id:f.traceId,parent_id:f.id,transaction_id:f.id,transaction:{type:f.type,sampled:f.sampled}})),bt(yt,l)},e.logErrorEvent=function(t,e){if(void 0!==t){var n=this.createErrorDataModel(t);if(void 0!==n.exception.message)return e?this._apmServer.sendErrors([n]):this._apmServer.addError(n)}},e.registerListeners=function(){var e=this;window.addEventListener("error",function(t){return e.logErrorEvent(t)}),window.addEventListener("unhandledrejection",function(t){return e.logPromiseEvent(t)})},e.logPromiseEvent=function(t){var e="Unhandled promise rejection: ",n=t.reason;null==n?this.logError(e+"<no reason specified>"):"string"==typeof n.message?this.logError({message:e+n.message,stack:n.stack?n.stack:null}):"object"!=typeof n&&this.logError(e+n)},e.logError=function(t){var e={};return"string"==typeof t?e.message=t:e.error=t,this.logErrorEvent(e)},e._getErrorProperties=function(n){var r={};return Object.keys(n).forEach(function(t){if("stack"!==t){var e=n[t];if(null!==e){switch(typeof e){case"function":return;case"object":if("function"!=typeof e.toISOString)return;e=e.toISOString()}r[t]=e}}}),r},t}(),Tt=function(r){r.registerServiceCreator("ErrorLogging",function(){var t=r.getService("ApmServer"),e=r.getService("ConfigService"),n=r.getService("TransactionService");return new wt(t,e,n)})},Et=[["#","hash"],["?","query"],["/","path"],["@","auth",1],[NaN,"host",void 0,1]],xt=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,Ct=function(){function t(t){var e,n=this.extractProtocol(t||""),r=n.protocol,i=n.address,o=n.slashes,a=!r&&!o,s=this.getLocation(),c=Et.slice();i=i.replace("\\","/"),o||(c[2]=[NaN,"path"]);for(var u=0;u<c.length;u++){var f=c[u],d=f[0],v=f[1];if("string"==typeof d){if(~(e=i.indexOf(d))){var h=f[2];if(h){var l=i.lastIndexOf(d);e=Math.max(e,l),this[v]=i.slice(0,e),i=i.slice(e+h)}else this[v]=i.slice(e),i=i.slice(0,e)}}else this[v]=i,i="";this[v]=this[v]||a&&f[3]&&s[v]||"",f[3]&&(this[v]=this[v].toLowerCase())}a&&"/"!==this.path.charAt(0)&&(this.path="/"+this.path),this.relative=a,this.protocol=r||s.protocol,this.origin=this.protocol&&this.host&&"file:"!==this.protocol?this.protocol+"//"+this.host:"null",this.href=this.toString()}var e=t.prototype;return e.toString=function(){var t=this.protocol;if(t+="//",this.auth){var e="[REDACTED]",n=this.auth.split(":");t+=(n[0]?e:"")+(n[1]?":"+e:"")+"@"}return t+=this.host,t+=this.path,t+=this.query,t+=this.hash},e.getLocation=function(){var t={};return"undefined"!=typeof window&&(t=window),t.location},e.extractProtocol=function(t){var e=xt.exec(t);return{protocol:e[1]?e[1].toLowerCase():"",slashes:!!e[2],address:e[3]}},t}(),Lt=function(){function t(t,e,n,r){this._apmServer=t,this._configService=e,this._logginService=n,this._transactionService=r}var e=t.prototype;return e.init=function(t){var n=this;void 0===t&&(t={}),this._configService.events.observe(X+":after",function(t){var e=n.createTransactionPayload(t);e&&n._apmServer.addTransaction(e)}),t[G]&&ot.observe(G,this.getHistorySub()),t[Y]&&ot.observe(Y,this.getXHRSub()),t[Z]&&ot.observe(Z,this.getFetchSub())},e.getHistorySub=function(){var n=this._transactionService;return function(t,e){e.source===G&&t===P&&n.startTransaction(e.data.title,"route-change",{managed:!0,canReuse:!0})}},e.getXHRSub=function(){var n=this;return function(t,e){e.source!==Y||O.fetchInProgress||n.processAPICalls(t,e)}},e.getFetchSub=function(){var n=this;return function(t,e){e.source===Z&&n.processAPICalls(t,e)}},e.processAPICalls=function(t,e){var n=this._configService,r=this._transactionService;if(t===M&&e.data){var i=new Ct(e.data.url),o=e.data.method+" "+(i.relative?i.path:l(i.href)),a=r.startSpan(o,"external.http"),s=r.addTask();if(!a)return;var c=n.get("distributedTracing"),u=n.get("distributedTracingOrigins"),f=new Ct(window.location.href),d=h(i.origin,f.origin)||h(i.origin,u),v=e.data.target;c&&d&&v&&this.injectDtHeader(a,v),a.addContext({http:{method:e.data.method,url:i.href}}),a.sync=e.data.sync,e.data.span=a,e.id=s}t===P&&e.data&&e.data.span&&(void 0!==e.data.target.status?e.data.span.addContext({http:{status_code:e.data.target.status}}):e.data.response&&e.data.span.addContext({http:{status_code:e.data.response.status}}),e.data.span.end()),t===P&&e.id&&r.removeTask(e.id)},e.injectDtHeader=function(t,e){var n,r=this._configService,i=r.get("distributedTracingHeaderName"),o=r.get("distributedTracingHeaderValueCallback")(t),a=/^[\da-f]{2}-[\da-f]{32}-[\da-f]{16}-[\da-f]{2}$/.test(n=o)&&"00000000000000000000000000000000"!==n.slice(3,35)&&"0000000000000000"!==n.slice(36,52);i&&o&&a&&("function"==typeof e.setRequestHeader?e.setRequestHeader(i,o):e.headers&&"function"==typeof e.headers.append?e.headers.append(i,o):e[i]=o)},e.extractDtHeader=function(t){var e=this._configService.get("distributedTracingHeaderName");if(t)return function(t){var e=/^([\da-f]{2})-([\da-f]{32})-([\da-f]{16})-([\da-f]{2})$/.exec(t);if(e){var n="00"!==e[4];return{traceId:e[2],id:e[3],sampled:n}}}(t[e])},e.setTransactionContext=function(t){var e=this._configService.get("context");e&&t.addContext(e)},e.filterTransaction=function(t){var e=this._configService.get("transactionDurationThreshold"),n=t.duration();if(!n)return!1;if(e<n)return!1;if(0===t.spans.length)return!1;t.sampled||t.resetSpans();var r=this._configService.get("browserResponsivenessInterval");if(this._configService.get("checkBrowserResponsiveness")&&t.options.checkBrowserResponsiveness){var i=this._configService.get("browserResponsivenessBuffer");if(!this.checkBrowserResponsiveness(t,r,i))return!1}return!0},e.prepareTransaction=function(e){if(e.spans.sort(function(t,e){return t._start-e._start}),this._configService.get("groupSimilarSpans")){var t=this._configService.get("similarSpanThreshold");e.spans=this.groupSmallContinuouslySimilarSpans(e,t)}e.spans=e.spans.filter(function(t){return 0<t.duration()&&t._start>=e._start&&t._end<=e._end}),this.setTransactionContext(e)},e.createTransactionDataModel=function(n){var t=this._configService.get("context"),r=n._start,e=n.spans.map(function(t){var e={id:t.id,transaction_id:n.id,parent_id:t.parentId||n.id,trace_id:n.traceId,name:t.name,type:t.type,subType:t.subType,action:t.action,sync:t.sync,start:t._start-r,duration:t.duration(),context:t.context};return bt(gt,e)}),i=b({},t,n.context),o={id:n.id,trace_id:n.traceId,name:n.name,type:n.type,duration:n.duration(),spans:e,context:i,marks:n.marks,breakdown:n.breakdownTimings,span_count:{started:e.length},sampled:n.sampled};return bt(mt,o)},e.createTransactionPayload=function(t){if(this.prepareTransaction(t),this.filterTransaction(t))return this.createTransactionDataModel(t)},e.convertTransactionsToServerModel=function(t){var e=this;return t.map(function(t){return e.createTransactionDataModel(t)})},e.groupSmallContinuouslySimilarSpans=function(o,a){var s=o.duration(),c=[],u=1;return o.spans.forEach(function(t,e){if(0===c.length)c.push(t);else{var n=c[c.length-1],r=n.type===t.type&&n.subType===t.subType&&n.action===t.action&&n.name===t.name&&t.duration()/s<a&&(t._start-n._end)/s<a,i=o.spans.length===e+1;r&&(u++,n._end=t._end),1<u&&(!r||i)&&(n.name=u+"x "+n.name,u=1),r||c.push(t)}}),c},e.checkBrowserResponsiveness=function(t,e,n){var r=t.browserResponsivenessCounter;if(void 0===e||void 0===r)return!0;var i=t.duration();return Math.floor(i/e)<=r+n},t}(),kt=function(){function t(t,e,n){void 0===n&&(n={}),t||(t=z),e||(e="custom"),this.name=t,this.type=e,this.options=n,this.id=n.id||p(16),this.traceId=n.traceId,this.sampled=n.sampled,this.timestamp=n.timestamp,this._start=L(n.startTime),this._end=void 0,this.ended=!1,this.onEnd=n.onEnd}var e=t.prototype;return e.ensureContext=function(){this.context||(this.context={})},e.addTags=function(t){console.warn("addTags deprecated, please use addLabels"),this.addLabels(t)},e.addLabels=function(e){this.ensureContext();var n=this.context;n.tags||(n.tags={}),Object.keys(e).forEach(function(t){return d(t,e[t],n.tags)})},e.addContext=function(t){t&&(this.ensureContext(),b(this.context,t))},e.end=function(t){this.ended||(this.ended=!0,this._end=L(t),this.callOnEnd())},e.callOnEnd=function(){"function"==typeof this.onEnd&&this.onEnd(this)},e.duration=function(){return k(this._start,this._end)},t}();var Ot=function(o){var t,e;function n(t,e,n){var r;if((r=o.call(this,t,e,n)||this).parentId=r.options.parentId,r.subType=void 0,r.action=void 0,-1!==r.type.indexOf(".")){var i=r.type.split(".",3);r.type=i[0],r.subType=i[1],r.action=i[2]}return r.sync=r.options.sync,r}return e=o,(t=n).prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e,n}(kt),It=[["domainLookupStart","domainLookupEnd","DNS"],["connectStart","connectEnd","TCP"],["requestStart","responseStart","Request"],["responseStart","responseEnd","Response"],["domLoading","domComplete","Processing"],["loadEventStart","loadEventEnd","Load"]];function Nt(t){return{value:t}}function At(t,e){var n=e.details,r=e.count,i=void 0===r?1:r,o=e.duration;return{transaction:t,span:n,samples:{"span.self_time.count":Nt(i),"span.self_time.sum.us":Nt(o)}}}var jt=function(i){var t,e;function n(t,e,n){var r;return(r=i.call(this,t,e,n)||this).traceId=p(),r.marks=void 0,r.spans=[],r._activeSpans={},r.nextAutoTaskId=1,r._scheduledTasks=[],r.captureTimings=!1,r.breakdownTimings=[],r.sampled=Math.random()<=r.options.transactionSampleRate,r}e=i,(t=n).prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e;var r=n.prototype;return r.addMarks=function(t){this.marks=b(this.marks||{},t)},r.mark=function(t){var e=E(t),n=C()-this._start,r={};r[e]=n,this.addMarks({custom:r})},r.canReuse=function(t){return void 0===t&&(t=5e3),!!this.options.canReuse&&!this.ended&&C()-this._start<t},r.redefine=function(t,e,n){t&&(this.name=t),e&&(this.type=e),n&&(this.options=S(this.options,n))},r.startSpan=function(t,e,n){var r=this;if(!this.ended){var i=S({},n);i.onEnd=function(t){r._onSpanEnd(t)},i.traceId=this.traceId,i.sampled=this.sampled,i.parentId||(i.parentId=this.id);var o=new Ot(t,e,i);return this._activeSpans[o.id]=o}},r.isFinished=function(){return 0===this._scheduledTasks.length},r.detectFinish=function(){this.isFinished()&&this.end()},r.end=function(t){if(!this.ended){for(var e in this.ended=!0,this._end=L(t),this._activeSpans){var n=this._activeSpans[e];n.type=n.type+".truncated",n.end(t)}var r=g();this.addContext(r),this.callOnEnd()}},r.captureBreakdown=function(){this.breakdownTimings=function(t,e){void 0===e&&(e=window.performance.timing);var s=[],n=t.duration(),r=t.name,i=t.type,o=t.sampled,c={name:r,type:i};if(s.push({transaction:c,samples:{"transaction.duration.count":Nt(1),"transaction.duration.sum.us":Nt(n),"transaction.breakdown.count":Nt(o?1:0)}}),!o)return s;if(i===U&&e)for(var a=0;a<It.length;a++){var u=It[a],f=k(e[u[0]],e[u[1]]);0!==f&&null!=f&&s.push(At(c,{details:{type:u[2]},duration:f}))}else{var d=function(t){var e={},n=function(t){var e=t.spans,n=t._start,r=t._end;if(0===e.length)return t.duration();e.sort(function(t,e){return t._start-e._start});for(var i=e[0],o=i._end,a=i._start,s=o,c=a-n,u=1;u<e.length;u++)a=(i=e[u])._start,o=i._end,s<a?(c+=a-s,s=o):s<o&&(s=o);return s<r&&(c+=r-s),c}(t);e.app={count:1,duration:n};for(var r=t.spans,i=0;i<r.length;i++){var o=r[i],a=o.duration();if(0!==a&&null!=a){var s=o.type,c=o.subType,u=s;c&&(u+="."+c),e[u]||(e[u]={duration:0,count:0}),e[u].count++,e[u].duration+=a}}return e}(t);Object.keys(d).forEach(function(t){var e=t.split("."),n=e[0],r=e[1],i=d[t],o=i.duration,a=i.count;s.push(At(c,{details:{type:n,subtype:r},duration:o,count:a}))})}return s}(this)},r.addTask=function(t){if(void 0===t&&(t="task"+this.nextAutoTaskId++),-1==this._scheduledTasks.indexOf(t))return this._scheduledTasks.push(t),t},r.removeTask=function(t){var e=this._scheduledTasks.indexOf(t);-1<e&&this._scheduledTasks.splice(e,1),this.detectFinish()},r.resetSpans=function(){this.spans=[]},r._onSpanEnd=function(t){this.spans.push(t),delete this._activeSpans[t.id]},n}(kt),Ft=[["domainLookupStart","domainLookupEnd","Domain lookup"],["connectStart","connectEnd","Making a connection to the server"],["requestStart","responseEnd","Requesting and receiving the document"],["domLoading","domInteractive","Parsing the document, executing sync. scripts"],["domContentLoadedEventStart","domContentLoadedEventEnd",'Fire "DOMContentLoaded" event'],["loadEventStart","loadEventEnd",'Fire "load" event']];function Rt(t,e,n,r,i){return void 0===i&&(i=0),"number"==typeof t&&"number"==typeof e&&i<=t&&t<e&&n<=t-i&&e-i<=r&&e-t<Q&&t-i<Q&&e-i<Q}function Mt(t){var e={transfer_size:t.transferSize,encoded_body_size:t.encodedBodySize,decoded_body_size:t.decodedBodySize},n=function(t){void 0===t&&(t=[]);for(var e=[],n=0;n<t.length;n++){var r=t[n],i=r.name,o=r.duration,a=r.description,s=i;a&&(s+=";desc="+a),o&&(s+=";dur="+o),e.push(s)}return e.join(", ")}(t.serverTiming);return n&&(e.headers={"server-timing":n}),e}function Pt(t){var e=t.name,n=t.initiatorType,r=t.startTime,i=t.responseEnd,o="resource";n&&(o+="."+n);var a=l(e),s=new Ot(a,o);return s.addContext({http:{url:e,response:Mt(t)}}),s._start=r,s.end(),s._end=i,s}function qt(e){if(e.captureTimings){var t=window.performance,n=e._end;if(e.type===U){if(e.marks&&e.marks.custom){var r=e.marks.custom;Object.keys(r).forEach(function(t){r[t]+=e._start})}e._start=0;var i=t.timing;(function(t,e,n,r){for(var i=[],o=0;o<Ft.length;o++){var a=t[Ft[o][0]],s=t[Ft[o][1]];if(Rt(a,s,n,r,e)){var c=new Ot(Ft[o][2],"hard-navigation.browser-timing");"requestStart"===Ft[o][0]&&(c.pageResponse=!0),c._start=a-e,c.ended=!0,c._end=s-e,i.push(c)}}return i})(i,i.fetchStart,0,n).forEach(function(t){t.traceId=e.traceId,t.sampled=e.sampled,t.pageResponse&&e.options.pageLoadSpanId&&(t.id=e.options.pageLoadSpanId),e.spans.push(t)}),e.addMarks(x())}if("function"==typeof t.getEntriesByType){var o=e._start;if(function(t,e,n,r){for(var i=[],o=0;o<t.length;o++){var a=t[o],s=a.initiatorType,c=a.name,u=a.startTime,f=a.responseEnd;if("xmlhttprequest"!==s&&"fetch"!==s&&c)if(-1!==D.indexOf(s)){if(!Rt(u,f,n,r))continue;i.push(Pt(t[o]))}else{if(null!=s)continue;for(var d=!1,v=0;v<e.length;v++){var h=c.lastIndexOf(e[v]);if(-1<h&&h===c.length-e[v].length){d=!0;break}}!d&&Rt(u,f,n,r)&&i.push(Pt(t[o]))}}return i}(t.getEntriesByType("resource"),function(t){for(var e=t.spans,n=[],r=0;r<e.length;r++){var i=e[r];"external"===i.type&&"http"===i.subType||n.push(i.name.split(" ")[1])}return n}(e),o,n).forEach(function(t){return e.spans.push(t)}),function(t,e,n){for(var r=[],i=0;i<t.length;i++){var o=t[i],a=o.name,s=o.startTime,c=o.duration,u=s+c;if(!(c<=$)&&Rt(s,u,e,n)){var f=new Ot(a,"app");f._start=s,f.end(),f._end=u,r.push(f)}}return r}(t.getEntriesByType("measure"),o,n).forEach(function(t){return e.spans.push(t)}),e.type===U){var a=t.getEntriesByType("navigation");a&&0<a.length&&(a=a[0],e.addContext({response:Mt(a)}))}}}}var Ht=function(){function t(t,e){this._config=e,this._logger=t,this.currentTransaction=void 0}var e=t.prototype;return e.ensureCurrentTransaction=function(t){t||(t=this.createOptions());var e=this.getCurrentTransaction();return e||(t.canReuse=!0,t.managed=!0,this.createTransaction(void 0,void 0,t))},e.getCurrentTransaction=function(){if(this.currentTransaction&&!this.currentTransaction.ended)return this.currentTransaction},e.setCurrentTransaction=function(t){this.currentTransaction=t},e.createTransaction=function(t,e,n){var r=new jt(t,e,n);return this.setCurrentTransaction(r),n.checkBrowserResponsiveness&&this.startCounter(r),r},e.startCounter=function(t){t.browserResponsivenessCounter=0;var e=this._config.get("browserResponsivenessInterval");if(void 0!==e)var n=setInterval(function(){t.ended?window.clearInterval(n):t.browserResponsivenessCounter++},e)},e.createOptions=function(t){var e=this._config.config,n=S({transactionSampleRate:e.transactionSampleRate},t);return n.managed&&(n=S({pageLoadTraceId:e.pageLoadTraceId,pageLoadSampled:e.pageLoadSampled,pageLoadSpanId:e.pageLoadSpanId,pageLoadTransactionName:e.pageLoadTransactionName,checkBrowserResponsiveness:e.checkBrowserResponsiveness},n)),n},e.startManagedTransaction=function(t,e,n){var r=this.getCurrentTransaction();return r?r.canReuse()&&n.canReuse?r.redefine(t,void 0,n):(r.end(),r=this.createTransaction(t,e,n)):r=this.createTransaction(t,e,n),r.captureTimings=!0,e===U&&(r.options.checkBrowserResponsiveness=!1,n.pageLoadTraceId&&(r.traceId=n.pageLoadTraceId),n.pageLoadSampled&&(r.sampled=n.pageLoadSampled),r.name===z&&n.pageLoadTransactionName&&(r.name=n.pageLoadTransactionName)),r},e.startTransaction=function(t,e,n){var r,i=this,o=this.createOptions(n);return(r=o.managed?this.startManagedTransaction(t,e,o):new jt(t,e,o)).onEnd=function(){return i.handleTransactionEnd(r)},this._config.events.send("transaction:start",[r]),r},e.handleTransactionEnd=function(r){var i=this;return f.Promise.resolve().then(function(){var t=r.name,e=r.type;if(!i.shouldIgnoreTransaction(t)){if(e===U){var n=i._config.get("pageLoadTransactionName");t===z&&n&&(r.name=n)}qt(r),i.adjustTransactionTime(r),i._config.get("breakdownMetrics")&&r.captureBreakdown(),i._config.events.send(X,[r])}},function(t){0})},e.adjustTransactionTime=function(t){var e=t.spans,n=function(t){for(var e=t[0],n=1;n<t.length;n++){var r=t[n];e._start>r._start&&(e=r)}return e}(e);n&&n._start<t._start&&(t._start=n._start);var r=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n];-1===String(r.type).indexOf("external")&&(!e||e._end<r._end)&&(e=r)}return e}(e);r&&r._end>t._end&&(t._end=r._end);for(var i=t._end,o=0;o<e.length;o++){var a=e[o];a._end>i&&(a._end=i,a.type+=".truncated"),a._start>i&&(a._start=i)}},e.shouldIgnoreTransaction=function(t){var e=this._config.get("ignoreTransactions");if(e&&e.length)for(var n=0;n<e.length;n++){var r=e[n];if("function"==typeof r.test){if(r.test(t))return!0}else if(r===t)return!0}return!1},e.startSpan=function(t,e,n){var r=this.ensureCurrentTransaction();if(r)return r.startSpan(t,e,n)},e.addTask=function(t){var e=this.ensureCurrentTransaction();if(e){t=e.addTask(t);0}return t},e.removeTask=function(t){var e=this.getCurrentTransaction();e&&e.removeTask(t)},t}(),Bt=function(i){i.registerServiceCreator("TransactionService",function(){var t=i.getService("ConfigService"),e=i.getService("LoggingService");return new Ht(e,t)}),i.registerServiceCreator("PerformanceMonitoring",function(){var t=i.getService("ConfigService"),e=i.getService("LoggingService"),n=i.getService("ApmServer"),r=i.getService("TransactionService");return new Lt(n,t,e,r)})},Dt=function(){function t(t,e){e||(e={}),this.onFlush=t,this.items=[],this.queueLimit=e.queueLimit||-1,this.flushInterval=e.flushInterval||0,this.timeoutId=void 0}var e=t.prototype;return e._setTimer=function(){var t=this;this.timeoutId=setTimeout(function(){t.flush()},this.flushInterval)},e.flush=function(){this.onFlush(this.items),this._clear()},e._clear=function(){void 0!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.items=[]},e.add=function(t){this.items.push(t),-1!==this.queueLimit&&this.items.length>=this.queueLimit?this.flush():void 0===this.timeoutId&&this._setTimer()},t}();var Qt=function(e,n,t){var r,i=t.context||this,o=t.limit,a=t.interval,s=t.countFn||function(){},c=0;return function(){var t="function"==typeof s&&s.apply(i,arguments);return"number"!=typeof t&&(t=1),c+=t,void 0===r&&(r=setTimeout(function(){r=void(c=0)},a)),o<c?"function"==typeof n?n.apply(i,arguments):void 0:e.apply(i,arguments)}},Ut=function(){function t(){}return t.stringify=function(t){return JSON.stringify(t)+"\n"},t}(),zt=function(){function t(t,e){this._configService=t,this._loggingService=e,this.errorQueue=void 0,this.transactionQueue=void 0,this.throttleAddError=void 0,this.throttleAddTransaction=void 0,this.initialized=!1}var e=t.prototype;return e.init=function(){this.initialized||(this.initialized=!0,this.initErrorQueue(),this.initTransactionQueue())},e.createMetaData=function(){var t=this._configService,e={service:{name:t.get("serviceName"),version:t.get("serviceVersion"),agent:{name:"js-base",version:t.version},language:{name:"javascript"},environment:t.get("environment")}};return bt(ht,e)},e._postJson=function(t,e){return this._makeHttpRequest("POST",t,{payload:e,headers:{"Content-Type":"application/x-ndjson"}}).then(function(t){return t.responseText})},e._constructError=function(t){var e=t.url,n=t.status;t.responseText;if(void 0===n)return t;var r=e+" HTTP status: "+n;return new Error(r)},e._makeHttpRequest=function(e,o,t){var n=void 0===t?{timeout:1e4}:t,a=n.timeout,s=n.payload,c=n.headers;return new f.Promise(function(n,r){var i=new window.XMLHttpRequest;if(i[A]=!0,i.open(e,o,!0),i.timeout=a,c)for(var t in c)c.hasOwnProperty(t)&&i.setRequestHeader(t,c[t]);i.onreadystatechange=function(){if(4===i.readyState){var t=i.status,e=i.responseText;0===t||399<t&&t<600?r({url:o,status:t,responseText:e}):n(i)}},i.onerror=function(){var t=i.status,e=i.responseText;r({url:o,status:t,responseText:e})},i.send(s)})},e._createQueue=function(t){var e=this._configService.get("queueLimit"),n=this._configService.get("flushInterval");return new Dt(t,{queueLimit:e,flushInterval:n})},e.fetchConfig=function(t,e){var o=this,n=this._configService.get("serverUrl")+"/config/v1/rum/agents";if(!t)return f.Promise.reject("serviceName is required for fetching central config.");n+="?service.name="+t,e&&(n+="&service.environment="+e);var a=this._configService.getLocalConfig();return a&&(n+="&ifnonematch="+a.etag),this._makeHttpRequest("GET",n,{timeout:5e3}).then(function(t){var e=t.status,n=t.responseText;if(304===e)return a;var r=JSON.parse(n),i=t.getResponseHeader("etag");return i&&(r.etag=i.replace(/["]/g,""),o._configService.setLocalConfig(r)),r}).catch(function(t){var e=o._constructError(t);return f.Promise.reject(e)})},e.initErrorQueue=function(){var n=this;this.errorQueue&&this.errorQueue.flush(),this.errorQueue=this._createQueue(function(t){var e=n.sendErrors(t);e&&e.catch(function(t){n._loggingService.warn("Failed sending errors!",n._constructError(t))})});var t=this._configService.get("errorThrottleLimit"),e=this._configService.get("errorThrottleInterval");this.throttleAddError=Qt(this.errorQueue.add.bind(this.errorQueue),function(){return n._loggingService.warn("Dropped error due to throttling!")},{limit:t,interval:e})},e.initTransactionQueue=function(){var n=this;this.transactionQueue&&this.transactionQueue.flush(),this.transactionQueue=this._createQueue(function(t){var e=n.sendTransactions(t);e&&e.catch(function(t){n._loggingService.warn("Failed sending transactions!",n._constructError(t))})});var t=this._configService.get("transactionThrottleLimit"),e=this._configService.get("transactionThrottleInterval");this.throttleAddTransaction=Qt(this.transactionQueue.add.bind(this.transactionQueue),function(){return n._loggingService.warn("Dropped transaction due to throttling!")},{limit:t,interval:e})},e.addError=function(t){this.errorQueue||this.initErrorQueue(),this.throttleAddError(t)},e.addTransaction=function(t){this.transactionQueue||this.initTransactionQueue(),this.throttleAddTransaction(t)},e.ndjsonErrors=function(t){return t.map(function(t){return Ut.stringify({error:t})})},e.ndjsonMetricsets=function(t){return t.map(function(t){return Ut.stringify({metricset:t})}).join("")},e.ndjsonTransactions=function(t){var r=this;return t.map(function(t){var e="";t.spans&&(e=t.spans.map(function(t){return Ut.stringify({span:t})}).join(""),delete t.spans);var n="";return t.breakdown&&(n=r.ndjsonMetricsets(t.breakdown),delete t.breakdown),Ut.stringify({transaction:t})+e+n})},e._send=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e="transaction"),0!==t.length){var n={service:this.createMetaData().service,data:t},r=this._configService.applyFilters(n);if(r){var i;if("errors"===e)i=this.ndjsonErrors(r.data);else{if("transaction"!==e)return void 0;i=this.ndjsonTransactions(r.data)}i.unshift(Ut.stringify({metadata:{service:r.service}}));var o=i.join(""),a=this._configService.getEndpointUrl();return this._postJson(a,o)}this._loggingService.warn("Dropped payload due to filtering!")}},e.sendTransactions=function(t){return this._send(t)},e.sendErrors=function(t){return this._send(t,"errors")},t}();var $t=function(){function t(){this.config={},this.defaults={serviceName:"",serviceVersion:"",environment:"",serverUrl:"http://localhost:8200",serverUrlPrefix:"/intake/v2/rum/events",active:!0,instrument:!0,disableInstrumentations:[],debug:!1,logLevel:"warn",breakdownMetrics:!1,browserResponsivenessInterval:500,browserResponsivenessBuffer:3,checkBrowserResponsiveness:!0,groupSimilarSpans:!0,similarSpanThreshold:.05,ignoreTransactions:[],errorThrottleLimit:20,errorThrottleInterval:3e4,transactionThrottleLimit:20,transactionThrottleInterval:3e4,transactionDurationThreshold:6e4,queueLimit:-1,flushInterval:500,distributedTracing:!0,distributedTracingOrigins:[],distributedTracingHeaderValueCallback:c,distributedTracingHeaderName:"elastic-apm-traceparent",pageLoadTraceId:"",pageLoadSpanId:"",pageLoadSampled:!1,pageLoadTransactionName:"",transactionSampleRate:1,centralConfig:!1,context:{}},this.events=new it,this.filters=[],this.version=""}var e=t.prototype;return e.init=function(){var t=function(t){if(!t)return{};for(var e={},n=/^data-([\w-]+)$/,r=t.attributes,i=0;i<r.length;i++){var o=r[i];if(n.test(o.nodeName)){var a=o.nodeName.match(n)[1],s=a.split("-").map(function(t,e){return 0<e?t.charAt(0).toUpperCase()+t.substring(1):t}).join("");e[s]=o.value||o.nodeValue}}return e}(_());this.setConfig(t)},e.isActive=function(){return this.get("active")},e.setVersion=function(t){this.version=t},e.addFilter=function(t){if("function"!=typeof t)throw new Error("Argument to must be function");this.filters.push(t)},e.applyFilters=function(t){for(var e=0;e<this.filters.length;e++)if(!(t=this.filters[e](t)))return;return t},e.get=function(t){return t.split(".").reduce(function(t,e){return t&&t[e]},this.config)},e.getEndpointUrl=function(){return this.config.serverUrl+this.config.serverUrlPrefix},e.setUserContext=function(t){void 0===t&&(t={});var e={},n=t,r=n.id,i=n.username,o=n.email;"number"!=typeof r&&"string"!=typeof r||(e.id=r),"string"==typeof i&&(e.username=i),"string"==typeof o&&(e.email=o),this.config.context.user=S(this.config.context.user||{},e)},e.setCustomContext=function(t){void 0===t&&(t={}),this.config.context.custom=S(this.config.context.custom||{},t)},e.addLabels=function(e){var n=this;this.config.context.tags||(this.config.context.tags={}),Object.keys(e).forEach(function(t){return d(t,e[t],n.config.context.tags)})},e.setConfig=function(t){void 0===t&&(t={}),t.serverUrl&&(t.serverUrl=t.serverUrl.replace(/\/+$/,"")),this.config=b({},this.defaults,this.config,t),this.events.send(J,[this.config])},e.validate=function(e){void 0===e&&(e={});var n=["serviceName","serverUrl"],r={missing:[],invalid:[]};Object.keys(e).forEach(function(t){-1===n.indexOf(t)||e[t]||r.missing.push(t)}),e.serviceName&&!/^[a-zA-Z0-9 _-]+$/.test(e.serviceName)&&r.invalid.push({key:"serviceName",value:e.serviceName,allowed:"a-z, A-Z, 0-9, _, -, <space>"});var t=e.transactionSampleRate;return void 0!==t&&("number"!=typeof t||isNaN(t)||t<0||1<t)&&r.invalid.push({key:"transactionSampleRate",value:t,allowed:"Number between 0 and 1"}),r},e.getLocalConfig=function(){var t=sessionStorage.getItem(K);if(t)return JSON.parse(t)},e.setLocalConfig=function(t){t&&sessionStorage.setItem(K,JSON.stringify(t))},t}(),Vt=function(){function t(t){void 0===t&&(t={}),this.levels=["trace","debug","info","warn","error"],this.level=t.level||"info",this.prefix=t.prefix||"",this.resetLogMethods()}var e=t.prototype;return e.shouldLog=function(t){return this.levels.indexOf(t)>=this.levels.indexOf(this.level)},e.setLevel=function(t){this.level=t,this.resetLogMethods()},e.resetLogMethods=function(){var o=this;this.levels.forEach(function(i){o[i]=o.shouldLog(i)?function(){var t,e=o.prefix;switch(i){case"trace":case"debug":t="info";break;default:t=i}var n=arguments;e&&(n[0]=e+n[0]);if(console){var r=console[t]||console.log;"function"==typeof r&&r.apply(console,n)}}:T})},t}(),Xt=function(){function t(){this._serviceCreators={},this._serviceInstances={},this.initialized=!1}var e=t.prototype;return e.registerCoreServices=function(){var t=this;this.registerServiceCreator("ConfigService",function(){return new $t}),this.registerServiceCreator("LoggingService",function(){return new Vt({prefix:"[Elastic APM] "})}),this.registerServiceCreator("ApmServer",function(){return new zt(t.getService("ConfigService"),t.getService("LoggingService"))})},e.init=function(){if(!this.initialized){this.initialized=!0;var t=this.getService("ConfigService");t.init();var e=this.getService("LoggingService");n(e,t),t.events.observe(J,function(){n(e,t)}),this.getService("ApmServer").init()}function n(t,e){var n=e.get("debug"),r=e.get("logLevel");!0===n&&"trace"!==r?t.setLevel("debug"):t.setLevel(r)}},e.registerServiceCreator=function(t,e){this._serviceCreators[t]=e},e.registerServiceInstance=function(t,e){this._serviceInstances[t]=e},e.getService=function(t){if(!this._serviceInstances[t]){if("function"!=typeof this._serviceCreators[t])throw new Error("Can not get service, No creator for: "+t);this._serviceInstances[t]=this._serviceCreators[t](this)}return this._serviceInstances[t]},t}();var Jt=function(){function t(t,e){this._disable=e,this.serviceFactory=t,this._initialized=!1}var e=t.prototype;return e.init=function(t){var e,n,r,i,o=this;if(this.isEnabled()&&!this._initialized){this._initialized=!0;var a=this.serviceFactory.getService("ConfigService");a.setVersion("4.6.0"),this.config(t);var s=this.serviceFactory.getService("LoggingService");if(a.isActive()){this.serviceFactory.init();var c=(e=a.get("instrument"),n=a.get("disableInstrumentations"),(r={})[Y]=!1,r[Z]=!1,r[G]=!1,r[U]=!1,r.error=!1,i=r,e&&Object.keys(i).forEach(function(t){-1===n.indexOf(t)&&(i[t]=!0)}),i);if(this.serviceFactory.getService("PerformanceMonitoring").init(c),c.error)this.serviceFactory.getService("ErrorLogging").registerListeners();var u=function(){return c[U]&&o._sendPageLoadMetrics()};a.get("centralConfig")?this.fetchCentralConfig().then(u):u()}else s.info("RUM agent is inactive")}return this},e.fetchCentralConfig=function(){var t=this.serviceFactory.getService("ApmServer"),c=this.serviceFactory.getService("LoggingService"),u=this.serviceFactory.getService("ConfigService");return t.fetchConfig(u.get("serviceName"),u.get("environment")).then(function(t){var e=t.transaction_sample_rate;if(e){var n={transactionSampleRate:e=Number(e)},r=u.validate(n).invalid;if(0===r.length)u.setConfig(n);else{var i=r[0],o=i.key,a=i.value,s=i.allowed;c.warn('invalid value "'+a+'" for '+o+". Allowed: "+s+".")}}return t}).catch(function(t){c.warn("failed fetching config:",t)})},e._sendPageLoadMetrics=function(){var t=this.serviceFactory.getService("TransactionService").startTransaction(void 0,U,{managed:!0,canReuse:!0});t&&t.addTask(U);var e=function(){setTimeout(function(){t&&t.removeTask(U)})};"complete"===document.readyState?e():window.addEventListener("load",e)},e.isEnabled=function(){return!this._disable},e.observe=function(t,e){this.serviceFactory.getService("ConfigService").events.observe(t,e)},e.config=function(t){var e=this.serviceFactory.getService("ConfigService"),n=e.validate(t),r=n.missing,o=n.invalid;if(0===r.length&&0===o.length)e.setConfig(t);else{var i=this.serviceFactory.getService("LoggingService"),a="RUM agent isn't correctly configured. ";0<r.length&&(a+=r.join(", ")+" is missing",0<o.length&&(a+=", ")),o.forEach(function(t,e){var n=t.key,r=t.value,i=t.allowed;a+=n+' "'+r+'" contains invalid characters! (allowed: '+i+")"+(e!==o.length-1?", ":"")}),i.error(a),e.setConfig({active:!1})}},e.setUserContext=function(t){this.serviceFactory.getService("ConfigService").setUserContext(t)},e.setCustomContext=function(t){this.serviceFactory.getService("ConfigService").setCustomContext(t)},e.addTags=function(t){this.serviceFactory.getService("LoggingService").warn("addTags deprecated, please use addLabels"),this.addLabels(t)},e.addLabels=function(t){this.serviceFactory.getService("ConfigService").addLabels(t)},e.setInitialPageLoadName=function(t){this.isEnabled()&&this.serviceFactory.getService("ConfigService").setConfig({pageLoadTransactionName:t})},e.startTransaction=function(t,e,n){if(this.isEnabled())return this.serviceFactory.getService("TransactionService").startTransaction(t,e,n)},e.startSpan=function(t,e){if(this.isEnabled())return this.serviceFactory.getService("TransactionService").startSpan(t,e)},e.getCurrentTransaction=function(){if(this.isEnabled())return this.serviceFactory.getService("TransactionService").getCurrentTransaction()},e.getTransactionService=function(){if(this.isEnabled())return this.serviceFactory.getService("TransactionService")},e.captureError=function(t){if(this.isEnabled())return this.serviceFactory.getService("ErrorLogging").logError(t)},e.addFilter=function(t){this.serviceFactory.getService("ConfigService").addFilter(t)},t}();n.d(e,"init",function(){return Wt}),n.d(e,"apmBase",function(){return Kt}),n.d(e,"apm",function(){return Kt}),n.d(e,"ApmBase",function(){return Jt});var Yt,Zt=(ct||(ct=!0,u()?(st(),ut=!0):"undefined"!=typeof window&&console.log("[Elastic APM] platform is not supported!")),ut),Gt=((Yt=new Xt).registerCoreServices(),Tt(Yt),Bt(Yt),Yt),Kt=new Jt(Gt,!Zt);"undefined"!=typeof window&&(window.elasticApm=Kt);var Wt=Kt.init.bind(Kt);e.default=Wt}]);
//# sourceMappingURL=elastic-apm-rum.umd.min.js.map